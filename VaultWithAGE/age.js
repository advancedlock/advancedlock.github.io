var age=(()=>{var Ze=Object.defineProperty;var ko=Object.getOwnPropertyDescriptor;var Mo=Object.getOwnPropertyNames;var Ko=Object.prototype.hasOwnProperty;var Ge=(e,t)=>{for(var n in t)Ze(e,n,{get:t[n],enumerable:!0})},qo=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Mo(t))!Ko.call(e,o)&&o!==n&&Ze(e,o,{get:()=>t[o],enumerable:!(r=ko(t,o))||r.enumerable});return e};var Do=e=>qo(Ze({},"__esModule",{value:!0}),e);var yi={};Ge(yi,{Decrypter:()=>$n,Encrypter:()=>Xn,Stanza:()=>lt,armor:()=>jn,generateIdentity:()=>bo,identityToRecipient:()=>mo,webauthn:()=>Pn});var Ct=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ht(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function j(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function Z(e,...t){if(!Ht(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Nt(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");j(e.outputLen),j(e.blockLen)}function Zt(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function er(e,t){Z(e);let n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function fe(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function Q(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function Gt(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function rt(e,t){return e<<32-t|e>>>t}function q(e,t){return e<<t|e>>>32-t>>>0}var Fo=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function jo(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}function zo(e){for(let t=0;t<e.length;t++)e[t]=jo(e[t]);return e}var Ve=Fo?e=>e:zo,nr=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Zo=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ot(e){if(Z(e),nr)return e.toHex();let t="";for(let n=0;n<e.length;n++)t+=Zo[e[n]];return t}var pt={_0:48,_9:57,A:65,F:70,a:97,f:102};function tr(e){if(e>=pt._0&&e<=pt._9)return e-pt._0;if(e>=pt.A&&e<=pt.F)return e-(pt.A-10);if(e>=pt.a&&e<=pt.f)return e-(pt.a-10)}function ae(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(nr)return Uint8Array.fromHex(e);let t=e.length,n=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let r=new Uint8Array(n);for(let o=0,s=0;o<n;o++,s+=2){let i=tr(e.charCodeAt(s)),c=tr(e.charCodeAt(s+1));if(i===void 0||c===void 0){let f=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+f+'" at index '+s)}r[o]=i*16+c}return r}function ue(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function St(e){return typeof e=="string"&&(e=ue(e)),Z(e),e}function Pe(e){return typeof e=="string"&&(e=ue(e)),Z(e),e}function Vt(...e){let t=0;for(let r=0;r<e.length;r++){let o=e[r];Z(o),t+=o.length}let n=new Uint8Array(t);for(let r=0,o=0;r<e.length;r++){let s=e[r];n.set(s,o),o+=s.length}return n}function le(e,t){if(t!==void 0&&{}.toString.call(t)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(e,t)}var zt=class{};function Xe(e){let t=r=>e().update(St(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function X(e=32){if(Ct&&typeof Ct.getRandomValues=="function")return Ct.getRandomValues(new Uint8Array(e));if(Ct&&typeof Ct.randomBytes=="function")return Uint8Array.from(Ct.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}var he=class extends zt{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Nt(t);let r=St(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),Q(s)}update(t){return Zt(this),this.iHash.update(t),this}digestInto(t){Zt(this),Z(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},xt=(e,t,n)=>new he(e,t).update(n).digest();xt.create=(e,t)=>new he(e,t);function Ye(e,t,n){return Nt(e),n===void 0&&(n=new Uint8Array(e.outputLen)),xt(e,St(n),St(t))}var $e=Uint8Array.from([0]),rr=Uint8Array.of();function Go(e,t,n,r=32){Nt(e),j(r);let o=e.outputLen;if(r>255*o)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(r/o);n===void 0&&(n=rr);let i=new Uint8Array(s*o),c=xt.create(e,t),f=c._cloneInto(),u=new Uint8Array(c.outputLen);for(let h=0;h<s;h++)$e[0]=h+1,f.update(h===0?rr:u).update(n).update($e).digestInto(u),i.set(u,o*h),c._cloneInto(f);return c.destroy(),f.destroy(),Q(u,$e),i.slice(0,r)}var vt=(e,t,n,r,o)=>Go(e,Ye(e,t,n),r,o);function Vo(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),f=r?4:0,u=r?0:4;e.setUint32(t+f,i,r),e.setUint32(t+u,c,r)}function or(e,t,n){return e&t^~e&n}function sr(e,t,n){return e&t^e&n^t&n}var Wt=class extends zt{constructor(t,n,r,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.buffer=new Uint8Array(t),this.view=Gt(this.buffer)}update(t){Zt(this),t=St(t),Z(t);let{view:n,buffer:r,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let c=Math.min(o-this.pos,s-i);if(c===o){let f=Gt(t);for(;o<=s-i;i+=o)this.process(f,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Zt(this),er(t,this),this.finished=!0;let{buffer:n,view:r,blockLen:o,isLE:s}=this,{pos:i}=this;n[i++]=128,Q(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;Vo(r,o-8,BigInt(this.length*8),s),this.process(r,0);let c=Gt(t),f=this.outputLen;if(f%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=f/4,h=this.get();if(u>h.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,h[l],s)}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=c,o%n&&t.buffer.set(r),t}clone(){return this._cloneInto()}},yt=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var G=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var de=BigInt(4294967295),ir=BigInt(32);function Po(e,t=!1){return t?{h:Number(e&de),l:Number(e>>ir&de)}:{h:Number(e>>ir&de)|0,l:Number(e&de)|0}}function cr(e,t=!1){let n=e.length,r=new Uint32Array(n),o=new Uint32Array(n);for(let s=0;s<n;s++){let{h:i,l:c}=Po(e[s],t);[r[s],o[s]]=[i,c]}return[r,o]}var We=(e,t,n)=>e>>>n,Qe=(e,t,n)=>e<<32-n|t>>>n,Rt=(e,t,n)=>e>>>n|t<<32-n,kt=(e,t,n)=>e<<32-n|t>>>n,Qt=(e,t,n)=>e<<64-n|t>>>n-32,Jt=(e,t,n)=>e>>>n-32|t<<64-n;function at(e,t,n,r){let o=(t>>>0)+(r>>>0);return{h:e+n+(o/2**32|0)|0,l:o|0}}var fr=(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),ar=(e,t,n,r)=>t+n+r+(e/2**32|0)|0,ur=(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),lr=(e,t,n,r,o)=>t+n+r+o+(e/2**32|0)|0,hr=(e,t,n,r,o)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(o>>>0),dr=(e,t,n,r,o,s)=>t+n+r+o+s+(e/2**32|0)|0;var $o=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),It=new Uint32Array(64),pe=class extends Wt{constructor(t=32){super(64,t,8,!1),this.A=yt[0]|0,this.B=yt[1]|0,this.C=yt[2]|0,this.D=yt[3]|0,this.E=yt[4]|0,this.F=yt[5]|0,this.G=yt[6]|0,this.H=yt[7]|0}get(){let{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:f}=this;return[t,n,r,o,s,i,c,f]}set(t,n,r,o,s,i,c,f){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=f|0}process(t,n){for(let l=0;l<16;l++,n+=4)It[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){let a=It[l-15],x=It[l-2],d=rt(a,7)^rt(a,18)^a>>>3,y=rt(x,17)^rt(x,19)^x>>>10;It[l]=y+It[l-7]+d+It[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:f,G:u,H:h}=this;for(let l=0;l<64;l++){let a=rt(c,6)^rt(c,11)^rt(c,25),x=h+a+or(c,f,u)+$o[l]+It[l]|0,y=(rt(r,2)^rt(r,13)^rt(r,22))+sr(r,o,s)|0;h=u,u=f,f=c,c=i+x|0,i=s,s=o,o=r,r=x+y|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,f=f+this.F|0,u=u+this.G|0,h=h+this.H|0,this.set(r,o,s,i,c,f,u,h)}roundClean(){Q(It)}destroy(){this.set(0,0,0,0,0,0,0,0),Q(this.buffer)}};var pr=cr(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),Yo=pr[0],Wo=pr[1],Ut=new Uint32Array(80),Lt=new Uint32Array(80),Je=class extends Wt{constructor(t=64){super(128,t,16,!1),this.Ah=G[0]|0,this.Al=G[1]|0,this.Bh=G[2]|0,this.Bl=G[3]|0,this.Ch=G[4]|0,this.Cl=G[5]|0,this.Dh=G[6]|0,this.Dl=G[7]|0,this.Eh=G[8]|0,this.El=G[9]|0,this.Fh=G[10]|0,this.Fl=G[11]|0,this.Gh=G[12]|0,this.Gl=G[13]|0,this.Hh=G[14]|0,this.Hl=G[15]|0}get(){let{Ah:t,Al:n,Bh:r,Bl:o,Ch:s,Cl:i,Dh:c,Dl:f,Eh:u,El:h,Fh:l,Fl:a,Gh:x,Gl:d,Hh:y,Hl:g}=this;return[t,n,r,o,s,i,c,f,u,h,l,a,x,d,y,g]}set(t,n,r,o,s,i,c,f,u,h,l,a,x,d,y,g){this.Ah=t|0,this.Al=n|0,this.Bh=r|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=c|0,this.Dl=f|0,this.Eh=u|0,this.El=h|0,this.Fh=l|0,this.Fl=a|0,this.Gh=x|0,this.Gl=d|0,this.Hh=y|0,this.Hl=g|0}process(t,n){for(let w=0;w<16;w++,n+=4)Ut[w]=t.getUint32(n),Lt[w]=t.getUint32(n+=4);for(let w=16;w<80;w++){let U=Ut[w-15]|0,k=Lt[w-15]|0,C=Rt(U,k,1)^Rt(U,k,8)^We(U,k,7),N=kt(U,k,1)^kt(U,k,8)^Qe(U,k,7),T=Ut[w-2]|0,b=Lt[w-2]|0,E=Rt(T,b,19)^Qt(T,b,61)^We(T,b,6),v=kt(T,b,19)^Jt(T,b,61)^Qe(T,b,6),L=ur(N,v,Lt[w-7],Lt[w-16]),B=lr(L,C,E,Ut[w-7],Ut[w-16]);Ut[w]=B|0,Lt[w]=L|0}let{Ah:r,Al:o,Bh:s,Bl:i,Ch:c,Cl:f,Dh:u,Dl:h,Eh:l,El:a,Fh:x,Fl:d,Gh:y,Gl:g,Hh:p,Hl:m}=this;for(let w=0;w<80;w++){let U=Rt(l,a,14)^Rt(l,a,18)^Qt(l,a,41),k=kt(l,a,14)^kt(l,a,18)^Jt(l,a,41),C=l&x^~l&y,N=a&d^~a&g,T=hr(m,k,N,Wo[w],Lt[w]),b=dr(T,p,U,C,Yo[w],Ut[w]),E=T|0,v=Rt(r,o,28)^Qt(r,o,34)^Qt(r,o,39),L=kt(r,o,28)^Jt(r,o,34)^Jt(r,o,39),B=r&s^r&c^s&c,S=o&i^o&f^i&f;p=y|0,m=g|0,y=x|0,g=d|0,x=l|0,d=a|0,{h:l,l:a}=at(u|0,h|0,b|0,E|0),u=c|0,h=f|0,c=s|0,f=i|0,s=r|0,i=o|0;let _=fr(E,L,S);r=ar(_,b,v,B),o=_|0}({h:r,l:o}=at(this.Ah|0,this.Al|0,r|0,o|0)),{h:s,l:i}=at(this.Bh|0,this.Bl|0,s|0,i|0),{h:c,l:f}=at(this.Ch|0,this.Cl|0,c|0,f|0),{h:u,l:h}=at(this.Dh|0,this.Dl|0,u|0,h|0),{h:l,l:a}=at(this.Eh|0,this.El|0,l|0,a|0),{h:x,l:d}=at(this.Fh|0,this.Fl|0,x|0,d|0),{h:y,l:g}=at(this.Gh|0,this.Gl|0,y|0,g|0),{h:p,l:m}=at(this.Hh|0,this.Hl|0,p|0,m|0),this.set(r,o,s,i,c,f,u,h,l,a,x,d,y,g,p,m)}roundClean(){Q(Ut,Lt)}destroy(){Q(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var te=Xe(()=>new pe);var xr=Xe(()=>new Je);var et=te;function rn(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Qo(e,...t){if(!rn(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function br(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function Jo(e){if(typeof e!="function")throw new Error("function expected");return!0}function Mt(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function on(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function tn(e){if(!Array.isArray(e))throw new Error("array expected")}function ye(e,t){if(!br(!0,t))throw new Error(`${e}: array of strings expected`)}function mr(e,t){if(!br(!1,t))throw new Error(`${e}: array of numbers expected`)}function sn(...e){let t=s=>s,n=(s,i)=>c=>s(i(c)),r=e.map(s=>s.encode).reduceRight(n,t),o=e.map(s=>s.decode).reduce(n,t);return{encode:r,decode:o}}function cn(e){let t=typeof e=="string"?e.split(""):e,n=t.length;ye("alphabet",t);let r=new Map(t.map((o,s)=>[o,s]));return{encode:o=>(tn(o),o.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${e}`);return t[s]})),decode:o=>(tn(o),o.map(s=>{Mt("alphabet.decode",s);let i=r.get(s);if(i===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${e}`);return i}))}}function fn(e=""){return Mt("join",e),{encode:t=>(ye("join.decode",t),t.join(e)),decode:t=>(Mt("join.decode",t),t.split(e))}}function ts(e,t="="){return on(e),Mt("padding",t),{encode(n){for(ye("padding.encode",n);n.length*e%8;)n.push(t);return n},decode(n){ye("padding.decode",n);let r=n.length;if(r*e%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if((r-1)*e%8===0)throw new Error("padding: invalid, string has too much padding");return n.slice(0,r)}}}var Er=(e,t)=>t===0?e:Er(t,e%t),ge=(e,t)=>e+(t-Er(e,t)),xe=(()=>{let e=[];for(let t=0;t<40;t++)e.push(2**t);return e})();function en(e,t,n,r){if(tn(e),t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(ge(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${ge(t,n)}`);let o=0,s=0,i=xe[t],c=xe[n]-1,f=[];for(let u of e){if(on(u),u>=i)throw new Error(`convertRadix2: invalid data word=${u} from=${t}`);if(o=o<<t|u,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)f.push((o>>s-n&c)>>>0);let h=xe[s];if(h===void 0)throw new Error("invalid carry");o&=h-1}if(o=o<<n-s&c,!r&&s>=t)throw new Error("Excess padding");if(!r&&o>0)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&f.push(o>>>0),f}function an(e,t=!1){if(on(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(ge(8,e)>32||ge(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!rn(n))throw new Error("radix2.encode input should be Uint8Array");return en(Array.from(n),8,e,!t)},decode:n=>(mr("radix2.decode",n),Uint8Array.from(en(n,e,8,t)))}}function yr(e){return Jo(e),function(...t){try{return e.apply(null,t)}catch{}}}var es=typeof Uint8Array.from([]).toBase64=="function"&&typeof Uint8Array.fromBase64=="function",ns=(e,t)=>{Mt("base64",e);let n=t?/^[A-Za-z0-9=_-]+$/:/^[A-Za-z0-9=+/]+$/,r=t?"base64url":"base64";if(e.length>0&&!n.test(e))throw new Error("invalid base64");return Uint8Array.fromBase64(e,{alphabet:r,lastChunkHandling:"strict"})},un=es?{encode(e){return Qo(e),e.toBase64()},decode(e){return ns(e,!1)}}:sn(an(6),cn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ts(6),fn("")),tt=sn(an(6),cn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),fn(""));var nn=sn(cn("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),fn("")),gr=[996825010,642813549,513874426,1027748829,705979059];function ee(e){let t=e>>25,n=(e&33554431)<<5;for(let r=0;r<gr.length;r++)(t>>r&1)===1&&(n^=gr[r]);return n}function wr(e,t,n=1){let r=e.length,o=1;for(let s=0;s<r;s++){let i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=ee(o)^i>>5}o=ee(o);for(let s=0;s<r;s++)o=ee(o)^e.charCodeAt(s)&31;for(let s of t)o=ee(o)^s;for(let s=0;s<6;s++)o=ee(o);return o^=n,nn.encode(en([o%xe[30]],30,5,!1))}function rs(e){let t=e==="bech32"?1:734539939,n=an(5),r=n.decode,o=n.encode,s=yr(r);function i(l,a,x=90){Mt("bech32.encode prefix",l),rn(a)&&(a=Array.from(a)),mr("bech32.encode",a);let d=l.length;if(d===0)throw new TypeError(`Invalid prefix length ${d}`);let y=d+7+a.length;if(x!==!1&&y>x)throw new TypeError(`Length ${y} exceeds limit ${x}`);let g=l.toLowerCase(),p=wr(g,a,t);return`${g}1${nn.encode(a)}${p}`}function c(l,a=90){Mt("bech32.decode input",l);let x=l.length;if(x<8||a!==!1&&x>a)throw new TypeError(`invalid string length: ${x} (${l}). Expected (8..${a})`);let d=l.toLowerCase();if(l!==d&&l!==l.toUpperCase())throw new Error("String must be lowercase or uppercase");let y=d.lastIndexOf("1");if(y===0||y===-1)throw new Error('Letter "1" must be present between prefix and data only');let g=d.slice(0,y),p=d.slice(y+1);if(p.length<6)throw new Error("Data must be at least 6 characters long");let m=nn.decode(p).slice(0,-6),w=wr(g,m,t);if(!p.endsWith(w))throw new Error(`Invalid checksum in ${l}: expected "${w}"`);return{prefix:g,words:m}}let f=yr(c);function u(l){let{prefix:a,words:x}=c(l,!1);return{prefix:a,words:x,bytes:r(x)}}function h(l,a){return i(l,o(a))}return{encode:i,decode:c,encodeFromBytes:h,decodeToBytes:u,decodeUnsafe:f,fromWords:r,fromWordsUnsafe:s,toWords:o}}var ut=rs("bech32");function ss(e,t,n,r){Nt(e);let o=le({dkLen:32,asyncTick:10},r),{c:s,dkLen:i,asyncTick:c}=o;if(j(s),j(i),j(c),s<1)throw new Error("iterations (c) should be >= 1");let f=Pe(t),u=Pe(n),h=new Uint8Array(i),l=xt.create(e,f),a=l._cloneInto().update(u);return{c:s,dkLen:i,asyncTick:c,DK:h,PRF:l,PRFSalt:a}}function is(e,t,n,r,o){return e.destroy(),t.destroy(),r&&r.destroy(),Q(o),n}function ln(e,t,n,r){let{c:o,dkLen:s,DK:i,PRF:c,PRFSalt:f}=ss(e,t,n,r),u,h=new Uint8Array(4),l=Gt(h),a=new Uint8Array(c.outputLen);for(let x=1,d=0;d<s;x++,d+=c.outputLen){let y=i.subarray(d,d+c.outputLen);l.setInt32(0,x,!1),(u=f._cloneInto(u)).update(h).digestInto(a),y.set(a.subarray(0,y.length));for(let g=1;g<o;g++){c._cloneInto(u).update(a).digestInto(a);for(let p=0;p<y.length;p++)y[p]^=a[p]}}return is(c,f,i,u,a)}function Br(e,t,n,r,o,s){let i=e[t++]^n[r++],c=e[t++]^n[r++],f=e[t++]^n[r++],u=e[t++]^n[r++],h=e[t++]^n[r++],l=e[t++]^n[r++],a=e[t++]^n[r++],x=e[t++]^n[r++],d=e[t++]^n[r++],y=e[t++]^n[r++],g=e[t++]^n[r++],p=e[t++]^n[r++],m=e[t++]^n[r++],w=e[t++]^n[r++],U=e[t++]^n[r++],k=e[t++]^n[r++],C=i,N=c,T=f,b=u,E=h,v=l,L=a,B=x,S=d,_=y,H=g,O=p,R=m,A=w,M=U,K=k;for(let D=0;D<8;D+=2)E^=q(C+R|0,7),S^=q(E+C|0,9),R^=q(S+E|0,13),C^=q(R+S|0,18),_^=q(v+N|0,7),A^=q(_+v|0,9),N^=q(A+_|0,13),v^=q(N+A|0,18),M^=q(H+L|0,7),T^=q(M+H|0,9),L^=q(T+M|0,13),H^=q(L+T|0,18),b^=q(K+O|0,7),B^=q(b+K|0,9),O^=q(B+b|0,13),K^=q(O+B|0,18),N^=q(C+b|0,7),T^=q(N+C|0,9),b^=q(T+N|0,13),C^=q(b+T|0,18),L^=q(v+E|0,7),B^=q(L+v|0,9),E^=q(B+L|0,13),v^=q(E+B|0,18),O^=q(H+_|0,7),S^=q(O+H|0,9),_^=q(S+O|0,13),H^=q(_+S|0,18),R^=q(K+M|0,7),A^=q(R+K|0,9),M^=q(A+R|0,13),K^=q(M+A|0,18);o[s++]=i+C|0,o[s++]=c+N|0,o[s++]=f+T|0,o[s++]=u+b|0,o[s++]=h+E|0,o[s++]=l+v|0,o[s++]=a+L|0,o[s++]=x+B|0,o[s++]=d+S|0,o[s++]=y+_|0,o[s++]=g+H|0,o[s++]=p+O|0,o[s++]=m+R|0,o[s++]=w+A|0,o[s++]=U+M|0,o[s++]=k+K|0}function hn(e,t,n,r,o){let s=r+0,i=r+16*o;for(let c=0;c<16;c++)n[i+c]=e[t+(2*o-1)*16+c];for(let c=0;c<o;c++,s+=16,t+=16)Br(n,i,e,t,n,s),c>0&&(i+=16),Br(n,s,e,t+=16,n,i)}function cs(e,t,n){let r=le({dkLen:32,asyncTick:10,maxmem:1073742848},n),{N:o,r:s,p:i,dkLen:c,asyncTick:f,maxmem:u,onProgress:h}=r;if(j(o),j(s),j(i),j(c),j(f),j(u),h!==void 0&&typeof h!="function")throw new Error("progressCb should be function");let l=128*s,a=l/4,x=Math.pow(2,32);if(o<=1||(o&o-1)!==0||o>x)throw new Error("Scrypt: N must be larger than 1, a power of 2, and less than 2^32");if(i<0||i>(x-1)*32/l)throw new Error("Scrypt: p must be a positive integer less than or equal to ((2^32 - 1) * 32) / (128 * r)");if(c<0||c>(x-1)*32)throw new Error("Scrypt: dkLen should be positive integer less than or equal to (2^32 - 1) * 32");if(l*(o+i)>u)throw new Error("Scrypt: memused is bigger than maxMem. Expected 128 * r * (N + p) > maxmem of "+u);let y=ln(te,e,t,{c:1,dkLen:l*i}),g=fe(y),p=fe(new Uint8Array(l*o)),m=fe(new Uint8Array(l)),w=()=>{};if(h){let U=2*o*i,k=Math.max(Math.floor(U/1e4),1),C=0;w=()=>{C++,h&&(!(C%k)||C===U)&&h(C/U)}}return{N:o,r:s,p:i,dkLen:c,blockSize32:a,V:p,B32:g,B:y,tmp:m,blockMixCb:w,asyncTick:f}}function fs(e,t,n,r,o){let s=ln(te,e,n,{c:1,dkLen:t});return Q(n,r,o),s}function dn(e,t,n){let{N:r,r:o,p:s,dkLen:i,blockSize32:c,V:f,B32:u,B:h,tmp:l,blockMixCb:a}=cs(e,t,n);Ve(u);for(let x=0;x<s;x++){let d=c*x;for(let y=0;y<c;y++)f[y]=u[d+y];for(let y=0,g=0;y<r-1;y++)hn(f,g,f,g+=c,o),a();hn(f,(r-1)*c,u,d,o),a();for(let y=0;y<r;y++){let g=u[d+c-16]%r;for(let p=0;p<c;p++)l[p]=u[d+p]^f[g*c+p];hn(l,0,u,d,o),a()}}return Ve(u),fs(e,i,h,f,l)}function Sr(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function we(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function be(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function $(e,...t){if(!Sr(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function pn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function vr(e,t){$(e);let n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}function gt(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function wt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function as(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}var us=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function ls(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function me(e){if(typeof e=="string")e=ls(e);else if(Sr(e))e=Ee(e);else throw new Error("Uint8Array expected, got "+typeof e);return e}function Ir(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Ur(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}var xn=(e,t)=>{function n(r,...o){if($(r),!us)throw new Error("Non little-endian hardware is not yet supported");if(e.nonceLength!==void 0){let h=o[0];if(!h)throw new Error("nonce / iv required");e.varSizeNonce?$(h):$(h,e.nonceLength)}let s=e.tagLength;s&&o[1]!==void 0&&$(o[1]);let i=t(r,...o),c=(h,l)=>{if(l!==void 0){if(h!==2)throw new Error("cipher output not supported");$(l)}},f=!1;return{encrypt(h,l){if(f)throw new Error("cannot encrypt() twice with same key + nonce");return f=!0,$(h),c(i.encrypt.length,l),i.encrypt(h,l)},decrypt(h,l){if($(h),s&&h.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return c(i.decrypt.length,l),i.decrypt(h,l)}}}return Object.assign(n,e),n};function yn(e,t,n=!0){if(t===void 0)return new Uint8Array(e);if(t.length!==e)throw new Error("invalid output length, expected "+e+", got: "+t.length);if(n&&!hs(t))throw new Error("invalid output, must be aligned");return t}function Ar(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);let o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),f=r?4:0,u=r?0:4;e.setUint32(t+f,i,r),e.setUint32(t+u,c,r)}function Lr(e,t,n){we(n);let r=new Uint8Array(16),o=as(r);return Ar(o,0,BigInt(t),n),Ar(o,8,BigInt(e),n),r}function hs(e){return e.byteOffset%4===0}function Ee(e){return Uint8Array.from(e)}var Tr=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),ds=Tr("expand 16-byte k"),ps=Tr("expand 32-byte k"),xs=gt(ds),ys=gt(ps);function I(e,t){return e<<t|e>>>32-t}function gn(e){return e.byteOffset%4===0}var Be=64,gs=16,Cr=2**32-1,_r=new Uint32Array;function ws(e,t,n,r,o,s,i,c){let f=o.length,u=new Uint8Array(Be),h=gt(u),l=gn(o)&&gn(s),a=l?gt(o):_r,x=l?gt(s):_r;for(let d=0;d<f;i++){if(e(t,n,r,h,i,c),i>=Cr)throw new Error("arx: counter overflow");let y=Math.min(Be,f-d);if(l&&y===Be){let g=d/4;if(d%4!==0)throw new Error("arx: invalid block position");for(let p=0,m;p<gs;p++)m=g+p,x[m]=a[m]^h[p];d+=Be;continue}for(let g=0,p;g<y;g++)p=d+g,s[p]=o[p]^u[g];d+=y}}function wn(e,t){let{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=Ir({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return be(o),be(i),we(s),we(n),(c,f,u,h,l=0)=>{$(c),$(f),$(u);let a=u.length;if(h===void 0&&(h=new Uint8Array(a)),$(h),be(l),l<0||l>=Cr)throw new Error("arx: counter overflow");if(h.length<a)throw new Error(`arx: output (${h.length}) is shorter than data (${a})`);let x=[],d=c.length,y,g;if(d===32)x.push(y=Ee(c)),g=ys;else if(d===16&&n)y=new Uint8Array(32),y.set(c),y.set(c,16),g=xs,x.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${d}`);gn(f)||x.push(f=Ee(f));let p=gt(y);if(r){if(f.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,p,gt(f.subarray(0,16)),p),f=f.subarray(16)}let m=16-o;if(m!==f.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(m!==12){let U=new Uint8Array(12);U.set(f,s?0:12-f.length),f=U,x.push(f)}let w=gt(f);return ws(e,g,p,w,u,h,l,i),wt(...x),h}}var V=(e,t)=>e[t++]&255|(e[t++]&255)<<8,bn=class{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,t=me(t),$(t,32);let n=V(t,0),r=V(t,2),o=V(t,4),s=V(t,6),i=V(t,8),c=V(t,10),f=V(t,12),u=V(t,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|c<<2)&8191,this.r[7]=(c>>>11|f<<5)&8065,this.r[8]=(f>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let h=0;h<8;h++)this.pad[h]=V(t,16+2*h)}process(t,n,r=!1){let o=r?0:2048,{h:s,r:i}=this,c=i[0],f=i[1],u=i[2],h=i[3],l=i[4],a=i[5],x=i[6],d=i[7],y=i[8],g=i[9],p=V(t,n+0),m=V(t,n+2),w=V(t,n+4),U=V(t,n+6),k=V(t,n+8),C=V(t,n+10),N=V(t,n+12),T=V(t,n+14),b=s[0]+(p&8191),E=s[1]+((p>>>13|m<<3)&8191),v=s[2]+((m>>>10|w<<6)&8191),L=s[3]+((w>>>7|U<<9)&8191),B=s[4]+((U>>>4|k<<12)&8191),S=s[5]+(k>>>1&8191),_=s[6]+((k>>>14|C<<2)&8191),H=s[7]+((C>>>11|N<<5)&8191),O=s[8]+((N>>>8|T<<8)&8191),R=s[9]+(T>>>5|o),A=0,M=A+b*c+E*(5*g)+v*(5*y)+L*(5*d)+B*(5*x);A=M>>>13,M&=8191,M+=S*(5*a)+_*(5*l)+H*(5*h)+O*(5*u)+R*(5*f),A+=M>>>13,M&=8191;let K=A+b*f+E*c+v*(5*g)+L*(5*y)+B*(5*d);A=K>>>13,K&=8191,K+=S*(5*x)+_*(5*a)+H*(5*l)+O*(5*h)+R*(5*u),A+=K>>>13,K&=8191;let D=A+b*u+E*f+v*c+L*(5*g)+B*(5*y);A=D>>>13,D&=8191,D+=S*(5*d)+_*(5*x)+H*(5*a)+O*(5*l)+R*(5*h),A+=D>>>13,D&=8191;let P=A+b*h+E*u+v*f+L*c+B*(5*g);A=P>>>13,P&=8191,P+=S*(5*y)+_*(5*d)+H*(5*x)+O*(5*a)+R*(5*l),A+=P>>>13,P&=8191;let st=A+b*l+E*h+v*u+L*f+B*c;A=st>>>13,st&=8191,st+=S*(5*g)+_*(5*y)+H*(5*d)+O*(5*x)+R*(5*a),A+=st>>>13,st&=8191;let it=A+b*a+E*l+v*h+L*u+B*f;A=it>>>13,it&=8191,it+=S*c+_*(5*g)+H*(5*y)+O*(5*d)+R*(5*x),A+=it>>>13,it&=8191;let ct=A+b*x+E*a+v*l+L*h+B*u;A=ct>>>13,ct&=8191,ct+=S*f+_*c+H*(5*g)+O*(5*y)+R*(5*d),A+=ct>>>13,ct&=8191;let ft=A+b*d+E*x+v*a+L*l+B*h;A=ft>>>13,ft&=8191,ft+=S*u+_*f+H*c+O*(5*g)+R*(5*y),A+=ft>>>13,ft&=8191;let ht=A+b*y+E*d+v*x+L*a+B*l;A=ht>>>13,ht&=8191,ht+=S*h+_*u+H*f+O*c+R*(5*g),A+=ht>>>13,ht&=8191;let dt=A+b*g+E*y+v*d+L*x+B*a;A=dt>>>13,dt&=8191,dt+=S*l+_*h+H*u+O*f+R*c,A+=dt>>>13,dt&=8191,A=(A<<2)+A|0,A=A+M|0,M=A&8191,A=A>>>13,K+=A,s[0]=M,s[1]=K,s[2]=D,s[3]=P,s[4]=st,s[5]=it,s[6]=ct,s[7]=ft,s[8]=ht,s[9]=dt}finalize(){let{h:t,pad:n}=this,r=new Uint16Array(10),o=t[1]>>>13;t[1]&=8191;for(let c=2;c<10;c++)t[c]+=o,o=t[c]>>>13,t[c]&=8191;t[0]+=o*5,o=t[0]>>>13,t[0]&=8191,t[1]+=o,o=t[1]>>>13,t[1]&=8191,t[2]+=o,r[0]=t[0]+5,o=r[0]>>>13,r[0]&=8191;for(let c=1;c<10;c++)r[c]=t[c]+o,o=r[c]>>>13,r[c]&=8191;r[9]-=8192;let s=(o^1)-1;for(let c=0;c<10;c++)r[c]&=s;s=~s;for(let c=0;c<10;c++)t[c]=t[c]&s|r[c];t[0]=(t[0]|t[1]<<13)&65535,t[1]=(t[1]>>>3|t[2]<<10)&65535,t[2]=(t[2]>>>6|t[3]<<7)&65535,t[3]=(t[3]>>>9|t[4]<<4)&65535,t[4]=(t[4]>>>12|t[5]<<1|t[6]<<14)&65535,t[5]=(t[6]>>>2|t[7]<<11)&65535,t[6]=(t[7]>>>5|t[8]<<8)&65535,t[7]=(t[8]>>>8|t[9]<<5)&65535;let i=t[0]+n[0];t[0]=i&65535;for(let c=1;c<8;c++)i=(t[c]+n[c]|0)+(i>>>16)|0,t[c]=i&65535;wt(r)}update(t){pn(this),t=me(t),$(t);let{buffer:n,blockLen:r}=this,o=t.length;for(let s=0;s<o;){let i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(t,s);continue}n.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){wt(this.h,this.r,this.buffer,this.pad)}digestInto(t){pn(this),vr(t,this),this.finished=!0;let{buffer:n,h:r}=this,{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)t[s++]=r[i]>>>0,t[s++]=r[i]>>>8;return t}digest(){let{buffer:t,outputLen:n}=this;this.digestInto(t);let r=t.slice(0,n);return this.destroy(),r}};function bs(e){let t=(r,o)=>e(o).update(me(r)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}var Hr=bs(e=>new bn(e));function Rr(e,t,n,r,o,s=20){let i=e[0],c=e[1],f=e[2],u=e[3],h=t[0],l=t[1],a=t[2],x=t[3],d=t[4],y=t[5],g=t[6],p=t[7],m=o,w=n[0],U=n[1],k=n[2],C=i,N=c,T=f,b=u,E=h,v=l,L=a,B=x,S=d,_=y,H=g,O=p,R=m,A=w,M=U,K=k;for(let P=0;P<s;P+=2)C=C+E|0,R=I(R^C,16),S=S+R|0,E=I(E^S,12),C=C+E|0,R=I(R^C,8),S=S+R|0,E=I(E^S,7),N=N+v|0,A=I(A^N,16),_=_+A|0,v=I(v^_,12),N=N+v|0,A=I(A^N,8),_=_+A|0,v=I(v^_,7),T=T+L|0,M=I(M^T,16),H=H+M|0,L=I(L^H,12),T=T+L|0,M=I(M^T,8),H=H+M|0,L=I(L^H,7),b=b+B|0,K=I(K^b,16),O=O+K|0,B=I(B^O,12),b=b+B|0,K=I(K^b,8),O=O+K|0,B=I(B^O,7),C=C+v|0,K=I(K^C,16),H=H+K|0,v=I(v^H,12),C=C+v|0,K=I(K^C,8),H=H+K|0,v=I(v^H,7),N=N+L|0,R=I(R^N,16),O=O+R|0,L=I(L^O,12),N=N+L|0,R=I(R^N,8),O=O+R|0,L=I(L^O,7),T=T+B|0,A=I(A^T,16),S=S+A|0,B=I(B^S,12),T=T+B|0,A=I(A^T,8),S=S+A|0,B=I(B^S,7),b=b+E|0,M=I(M^b,16),_=_+M|0,E=I(E^_,12),b=b+E|0,M=I(M^b,8),_=_+M|0,E=I(E^_,7);let D=0;r[D++]=i+C|0,r[D++]=c+N|0,r[D++]=f+T|0,r[D++]=u+b|0,r[D++]=h+E|0,r[D++]=l+v|0,r[D++]=a+L|0,r[D++]=x+B|0,r[D++]=d+S|0,r[D++]=y+_|0,r[D++]=g+H|0,r[D++]=p+O|0,r[D++]=m+R|0,r[D++]=w+A|0,r[D++]=U+M|0,r[D++]=k+K|0}function ms(e,t,n,r){let o=e[0],s=e[1],i=e[2],c=e[3],f=t[0],u=t[1],h=t[2],l=t[3],a=t[4],x=t[5],d=t[6],y=t[7],g=n[0],p=n[1],m=n[2],w=n[3];for(let k=0;k<20;k+=2)o=o+f|0,g=I(g^o,16),a=a+g|0,f=I(f^a,12),o=o+f|0,g=I(g^o,8),a=a+g|0,f=I(f^a,7),s=s+u|0,p=I(p^s,16),x=x+p|0,u=I(u^x,12),s=s+u|0,p=I(p^s,8),x=x+p|0,u=I(u^x,7),i=i+h|0,m=I(m^i,16),d=d+m|0,h=I(h^d,12),i=i+h|0,m=I(m^i,8),d=d+m|0,h=I(h^d,7),c=c+l|0,w=I(w^c,16),y=y+w|0,l=I(l^y,12),c=c+l|0,w=I(w^c,8),y=y+w|0,l=I(l^y,7),o=o+u|0,w=I(w^o,16),d=d+w|0,u=I(u^d,12),o=o+u|0,w=I(w^o,8),d=d+w|0,u=I(u^d,7),s=s+h|0,g=I(g^s,16),y=y+g|0,h=I(h^y,12),s=s+h|0,g=I(g^s,8),y=y+g|0,h=I(h^y,7),i=i+l|0,p=I(p^i,16),a=a+p|0,l=I(l^a,12),i=i+l|0,p=I(p^i,8),a=a+p|0,l=I(l^a,7),c=c+f|0,m=I(m^c,16),x=x+m|0,f=I(f^x,12),c=c+f|0,m=I(m^c,8),x=x+m|0,f=I(f^x,7);let U=0;r[U++]=o,r[U++]=s,r[U++]=i,r[U++]=c,r[U++]=g,r[U++]=p,r[U++]=m,r[U++]=w}var Es=wn(Rr,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Bs=wn(Rr,{counterRight:!1,counterLength:8,extendNonceFn:ms,allowShortKeys:!1});var As=new Uint8Array(16),Nr=(e,t)=>{e.update(t);let n=t.length%16;n&&e.update(As.subarray(n))},Ss=new Uint8Array(32);function Or(e,t,n,r,o){let s=e(t,n,Ss),i=Hr.create(s);o&&Nr(i,o),Nr(i,r);let c=Lr(r.length,o?o.length:0,!0);i.update(c);let f=i.digest();return wt(s,c),f}var kr=e=>(t,n,r)=>({encrypt(s,i){let c=s.length;i=yn(c+16,i,!1),i.set(s);let f=i.subarray(0,-16);e(t,n,f,f,1);let u=Or(e,t,n,f,r);return i.set(u,c),wt(u),i},decrypt(s,i){i=yn(s.length-16,i,!1);let c=s.subarray(0,-16),f=s.subarray(-16),u=Or(e,t,n,c,r);if(!Ur(f,u))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),e(t,n,i,i,1),wt(u),i}}),_t=xn({blockSize:64,nonceLength:12,tagLength:16},kr(Es)),ec=xn({blockSize:64,nonceLength:24,tagLength:16},kr(Bs));var Bn=BigInt(0),En=BigInt(1);function Ae(e,t=""){if(typeof e!="boolean"){let n=t&&`"${t}"`;throw new Error(n+"expected boolean, got type="+typeof e)}return e}function ne(e,t,n=""){let r=Ht(e),o=e?.length,s=t!==void 0;if(!r||s&&o!==t){let i=n&&`"${n}" `,c=s?` of length ${t}`:"",f=r?`length=${o}`:`type=${typeof e}`;throw new Error(i+"expected Uint8Array"+c+", got "+f)}return e}function Mr(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?Bn:BigInt("0x"+e)}function Kr(e){return Mr(Ot(e))}function ot(e){return Z(e),Mr(Ot(Uint8Array.from(e).reverse()))}function An(e,t){return ae(e.toString(16).padStart(t*2,"0"))}function Se(e,t){return An(e,t).reverse()}function Y(e,t,n){let r;if(typeof t=="string")try{r=ae(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(Ht(t))r=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let o=r.length;if(typeof n=="number"&&o!==n)throw new Error(e+" of length "+n+" expected, got "+o);return r}function qr(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function Sn(e){return Uint8Array.from(e)}var mn=e=>typeof e=="bigint"&&Bn<=e;function vs(e,t,n){return mn(e)&&mn(t)&&mn(n)&&t<=e&&e<n}function Pt(e,t,n,r){if(!vs(t,n,r))throw new Error("expected valid "+e+": "+n+" <= n < "+r+", got "+t)}function Dr(e){let t;for(t=0;e>Bn;e>>=En,t+=1);return t}var re=e=>(En<<BigInt(e))-En;function Kt(e,t,n={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function r(o,s,i){let c=e[o];if(i&&c===void 0)return;let f=typeof c;if(f!==s||c===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${f}`)}Object.entries(t).forEach(([o,s])=>r(o,s,!1)),Object.entries(n).forEach(([o,s])=>r(o,s,!0))}var vn=()=>{throw new Error("not implemented")};function In(e){let t=new WeakMap;return(n,...r)=>{let o=t.get(n);if(o!==void 0)return o;let s=e(n,...r);return t.set(n,s),s}}var J=BigInt(0),W=BigInt(1),qt=BigInt(2),zr=BigInt(3),Zr=BigInt(4),Gr=BigInt(5),Is=BigInt(7),Vr=BigInt(8),Us=BigInt(9),Pr=BigInt(16);function F(e,t){let n=e%t;return n>=J?n:t+n}function nt(e,t,n){let r=e;for(;t-- >J;)r*=r,r%=n;return r}function Fr(e,t){if(e===J)throw new Error("invert: expected non-zero number");if(t<=J)throw new Error("invert: expected positive modulus, got "+t);let n=F(e,t),r=t,o=J,s=W,i=W,c=J;for(;n!==J;){let u=r/n,h=r%n,l=o-i*u,a=s-c*u;r=n,n=h,o=i,s=c,i=l,c=a}if(r!==W)throw new Error("invert: does not exist");return F(o,t)}function Un(e,t,n){if(!e.eql(e.sqr(t),n))throw new Error("Cannot find square root")}function Xr(e,t){let n=(e.ORDER+W)/Zr,r=e.pow(t,n);return Un(e,r,t),r}function Ls(e,t){let n=(e.ORDER-Gr)/Vr,r=e.mul(t,qt),o=e.pow(r,n),s=e.mul(t,o),i=e.mul(e.mul(s,qt),o),c=e.mul(s,e.sub(i,e.ONE));return Un(e,c,t),c}function _s(e){let t=mt(e),n=$r(e),r=n(t,t.neg(t.ONE)),o=n(t,r),s=n(t,t.neg(r)),i=(e+Is)/Pr;return(c,f)=>{let u=c.pow(f,i),h=c.mul(u,r),l=c.mul(u,o),a=c.mul(u,s),x=c.eql(c.sqr(h),f),d=c.eql(c.sqr(l),f);u=c.cmov(u,h,x),h=c.cmov(a,l,d);let y=c.eql(c.sqr(h),f),g=c.cmov(u,h,y);return Un(c,g,f),g}}function $r(e){if(e<zr)throw new Error("sqrt is not defined for small field");let t=e-W,n=0;for(;t%qt===J;)t/=qt,n++;let r=qt,o=mt(e);for(;jr(o,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(n===1)return Xr;let s=o.pow(r,t),i=(t+W)/qt;return function(f,u){if(f.is0(u))return u;if(jr(f,u)!==1)throw new Error("Cannot find square root");let h=n,l=f.mul(f.ONE,s),a=f.pow(u,t),x=f.pow(u,i);for(;!f.eql(a,f.ONE);){if(f.is0(a))return f.ZERO;let d=1,y=f.sqr(a);for(;!f.eql(y,f.ONE);)if(d++,y=f.sqr(y),d===h)throw new Error("Cannot find square root");let g=W<<BigInt(h-d-1),p=f.pow(l,g);h=d,l=f.sqr(p),a=f.mul(a,l),x=f.mul(x,p)}return x}}function Ts(e){return e%Zr===zr?Xr:e%Vr===Gr?Ls:e%Pr===Us?_s(e):$r(e)}var bt=(e,t)=>(F(e,t)&W)===W,Cs=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Yr(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},n=Cs.reduce((r,o)=>(r[o]="function",r),t);return Kt(e,n),e}function Hs(e,t,n){if(n<J)throw new Error("invalid exponent, negatives unsupported");if(n===J)return e.ONE;if(n===W)return t;let r=e.ONE,o=t;for(;n>J;)n&W&&(r=e.mul(r,o)),o=e.sqr(o),n>>=W;return r}function ve(e,t,n=!1){let r=new Array(t.length).fill(n?e.ZERO:void 0),o=t.reduce((i,c,f)=>e.is0(c)?i:(r[f]=i,e.mul(i,c)),e.ONE),s=e.inv(o);return t.reduceRight((i,c,f)=>e.is0(c)?i:(r[f]=e.mul(i,r[f]),e.mul(i,c)),s),r}function jr(e,t){let n=(e.ORDER-W)/qt,r=e.pow(t,n),o=e.eql(r,e.ONE),s=e.eql(r,e.ZERO),i=e.eql(r,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function Wr(e,t){t!==void 0&&j(t);let n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function mt(e,t,n=!1,r={}){if(e<=J)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,s,i=!1,c;if(typeof t=="object"&&t!=null){if(r.sqrt||n)throw new Error("cannot specify opts in two arguments");let a=t;a.BITS&&(o=a.BITS),a.sqrt&&(s=a.sqrt),typeof a.isLE=="boolean"&&(n=a.isLE),typeof a.modFromBytes=="boolean"&&(i=a.modFromBytes),c=a.allowedLengths}else typeof t=="number"&&(o=t),r.sqrt&&(s=r.sqrt);let{nBitLength:f,nByteLength:u}=Wr(e,o);if(u>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let h,l=Object.freeze({ORDER:e,isLE:n,BITS:f,BYTES:u,MASK:re(f),ZERO:J,ONE:W,allowedLengths:c,create:a=>F(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof a);return J<=a&&a<e},is0:a=>a===J,isValidNot0:a=>!l.is0(a)&&l.isValid(a),isOdd:a=>(a&W)===W,neg:a=>F(-a,e),eql:(a,x)=>a===x,sqr:a=>F(a*a,e),add:(a,x)=>F(a+x,e),sub:(a,x)=>F(a-x,e),mul:(a,x)=>F(a*x,e),pow:(a,x)=>Hs(l,a,x),div:(a,x)=>F(a*Fr(x,e),e),sqrN:a=>a*a,addN:(a,x)=>a+x,subN:(a,x)=>a-x,mulN:(a,x)=>a*x,inv:a=>Fr(a,e),sqrt:s||(a=>(h||(h=Ts(e)),h(l,a))),toBytes:a=>n?Se(a,u):An(a,u),fromBytes:(a,x=!0)=>{if(c){if(!c.includes(a.length)||a.length>u)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+a.length);let y=new Uint8Array(u);y.set(a,n?0:y.length-a.length),a=y}if(a.length!==u)throw new Error("Field.fromBytes: expected "+u+" bytes, got "+a.length);let d=n?ot(a):Kr(a);if(i&&(d=F(d,e)),!x&&!l.isValid(d))throw new Error("invalid field element: outside of range 0..ORDER");return d},invertBatch:a=>ve(l,a),cmov:(a,x,d)=>d?x:a});return Object.freeze(l)}var Ie=BigInt(0),Cn=BigInt(1);function Qr(e,t){let n=t.negate();return e?n:t}function oe(e,t){let n=ve(e.Fp,t.map(r=>r.Z));return t.map((r,o)=>e.fromAffine(r.toAffine(n[o])))}function no(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Ln(e,t){no(e,t);let n=Math.ceil(t/e)+1,r=2**(e-1),o=2**e,s=re(e),i=BigInt(e);return{windows:n,windowSize:r,mask:s,maxNumber:o,shiftBy:i}}function Jr(e,t,n){let{windowSize:r,mask:o,maxNumber:s,shiftBy:i}=n,c=Number(e&o),f=e>>i;c>r&&(c-=s,f+=Cn);let u=t*r,h=u+Math.abs(c)-1,l=c===0,a=c<0,x=t%2!==0;return{nextN:f,offset:h,isZero:l,isNeg:a,isNegF:x,offsetF:u}}function Ns(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((n,r)=>{if(!(n instanceof t))throw new Error("invalid point at index "+r)})}function Os(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((n,r)=>{if(!t.isValid(n))throw new Error("invalid scalar at index "+r)})}var _n=new WeakMap,ro=new WeakMap;function Tn(e){return ro.get(e)||1}function to(e){if(e!==Ie)throw new Error("invalid wNAF")}var Ue=class{constructor(t,n){this.BASE=t.BASE,this.ZERO=t.ZERO,this.Fn=t.Fn,this.bits=n}_unsafeLadder(t,n,r=this.ZERO){let o=t;for(;n>Ie;)n&Cn&&(r=r.add(o)),o=o.double(),n>>=Cn;return r}precomputeWindow(t,n){let{windows:r,windowSize:o}=Ln(n,this.bits),s=[],i=t,c=i;for(let f=0;f<r;f++){c=i,s.push(c);for(let u=1;u<o;u++)c=c.add(i),s.push(c);i=c.double()}return s}wNAF(t,n,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let o=this.ZERO,s=this.BASE,i=Ln(t,this.bits);for(let c=0;c<i.windows;c++){let{nextN:f,offset:u,isZero:h,isNeg:l,isNegF:a,offsetF:x}=Jr(r,c,i);r=f,h?s=s.add(Qr(a,n[x])):o=o.add(Qr(l,n[u]))}return to(r),{p:o,f:s}}wNAFUnsafe(t,n,r,o=this.ZERO){let s=Ln(t,this.bits);for(let i=0;i<s.windows&&r!==Ie;i++){let{nextN:c,offset:f,isZero:u,isNeg:h}=Jr(r,i,s);if(r=c,!u){let l=n[f];o=o.add(h?l.negate():l)}}return to(r),o}getPrecomputes(t,n,r){let o=_n.get(n);return o||(o=this.precomputeWindow(n,t),t!==1&&(typeof r=="function"&&(o=r(o)),_n.set(n,o))),o}cached(t,n,r){let o=Tn(t);return this.wNAF(o,this.getPrecomputes(o,t,r),n)}unsafe(t,n,r,o){let s=Tn(t);return s===1?this._unsafeLadder(t,n,o):this.wNAFUnsafe(s,this.getPrecomputes(s,t,r),n,o)}createCache(t,n){no(n,this.bits),ro.set(t,n),_n.delete(t)}hasCache(t){return Tn(t)!==1}};function Le(e,t,n,r){Ns(n,e),Os(r,t);let o=n.length,s=r.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=e.ZERO,c=Dr(BigInt(o)),f=1;c>12?f=c-3:c>4?f=c-2:c>0&&(f=2);let u=re(f),h=new Array(Number(u)+1).fill(i),l=Math.floor((t.BITS-1)/f)*f,a=i;for(let x=l;x>=0;x-=f){h.fill(i);for(let y=0;y<s;y++){let g=r[y],p=Number(g>>BigInt(x)&u);h[p]=h[p].add(n[y])}let d=i;for(let y=h.length-1,g=i;y>0;y--)g=g.add(h[y]),d=d.add(g);if(a=a.add(d),x!==0)for(let y=0;y<f;y++)a=a.double()}return a}function eo(e,t,n){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Yr(t),t}else return mt(e,{isLE:n})}function oo(e,t,n={},r){if(r===void 0&&(r=e==="edwards"),!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let f of["p","n","h"]){let u=t[f];if(!(typeof u=="bigint"&&u>Ie))throw new Error(`CURVE.${f} must be positive bigint`)}let o=eo(t.p,n.Fp,r),s=eo(t.n,n.Fn,r),c=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let f of c)if(!o.isValid(t[f]))throw new Error(`CURVE.${f} must be valid field element of CURVE.Fp`);return t=Object.freeze(Object.assign({},t)),{CURVE:t,Fp:o,Fn:s}}var Tt=BigInt(0),z=BigInt(1),Hn=BigInt(2),Rs=BigInt(8);function ks(e,t,n,r){let o=e.sqr(n),s=e.sqr(r),i=e.add(e.mul(t.a,o),s),c=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,c)}function Ms(e,t={}){let n=oo("edwards",e,t,t.FpFnLE),{Fp:r,Fn:o}=n,s=n.CURVE,{h:i}=s;Kt(t,{},{uvRatio:"function"});let c=Hn<<BigInt(o.BYTES*8)-z,f=g=>r.create(g),u=t.uvRatio||((g,p)=>{try{return{isValid:!0,value:r.sqrt(r.div(g,p))}}catch{return{isValid:!1,value:Tt}}});if(!ks(r,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function h(g,p,m=!1){let w=m?z:Tt;return Pt("coordinate "+g,p,w,c),p}function l(g){if(!(g instanceof d))throw new Error("ExtendedPoint expected")}let a=In((g,p)=>{let{X:m,Y:w,Z:U}=g,k=g.is0();p==null&&(p=k?Rs:r.inv(U));let C=f(m*p),N=f(w*p),T=r.mul(U,p);if(k)return{x:Tt,y:z};if(T!==z)throw new Error("invZ was invalid");return{x:C,y:N}}),x=In(g=>{let{a:p,d:m}=s;if(g.is0())throw new Error("bad point: ZERO");let{X:w,Y:U,Z:k,T:C}=g,N=f(w*w),T=f(U*U),b=f(k*k),E=f(b*b),v=f(N*p),L=f(b*f(v+T)),B=f(E+f(m*f(N*T)));if(L!==B)throw new Error("bad point: equation left != right (1)");let S=f(w*U),_=f(k*C);if(S!==_)throw new Error("bad point: equation left != right (2)");return!0});class d{constructor(p,m,w,U){this.X=h("x",p),this.Y=h("y",m),this.Z=h("z",w,!0),this.T=h("t",U),Object.freeze(this)}static CURVE(){return s}static fromAffine(p){if(p instanceof d)throw new Error("extended point not allowed");let{x:m,y:w}=p||{};return h("x",m),h("y",w),new d(m,w,z,f(m*w))}static fromBytes(p,m=!1){let w=r.BYTES,{a:U,d:k}=s;p=Sn(ne(p,w,"point")),Ae(m,"zip215");let C=Sn(p),N=p[w-1];C[w-1]=N&-129;let T=ot(C),b=m?c:r.ORDER;Pt("point.y",T,Tt,b);let E=f(T*T),v=f(E-z),L=f(k*E-U),{isValid:B,value:S}=u(v,L);if(!B)throw new Error("bad point: invalid y coordinate");let _=(S&z)===z,H=(N&128)!==0;if(!m&&S===Tt&&H)throw new Error("bad point: x=0 and x_0=1");return H!==_&&(S=f(-S)),d.fromAffine({x:S,y:T})}static fromHex(p,m=!1){return d.fromBytes(Y("point",p),m)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(p=8,m=!0){return y.createCache(this,p),m||this.multiply(Hn),this}assertValidity(){x(this)}equals(p){l(p);let{X:m,Y:w,Z:U}=this,{X:k,Y:C,Z:N}=p,T=f(m*N),b=f(k*U),E=f(w*N),v=f(C*U);return T===b&&E===v}is0(){return this.equals(d.ZERO)}negate(){return new d(f(-this.X),this.Y,this.Z,f(-this.T))}double(){let{a:p}=s,{X:m,Y:w,Z:U}=this,k=f(m*m),C=f(w*w),N=f(Hn*f(U*U)),T=f(p*k),b=m+w,E=f(f(b*b)-k-C),v=T+C,L=v-N,B=T-C,S=f(E*L),_=f(v*B),H=f(E*B),O=f(L*v);return new d(S,_,O,H)}add(p){l(p);let{a:m,d:w}=s,{X:U,Y:k,Z:C,T:N}=this,{X:T,Y:b,Z:E,T:v}=p,L=f(U*T),B=f(k*b),S=f(N*w*v),_=f(C*E),H=f((U+k)*(T+b)-L-B),O=_-S,R=_+S,A=f(B-m*L),M=f(H*O),K=f(R*A),D=f(H*A),P=f(O*R);return new d(M,K,P,D)}subtract(p){return this.add(p.negate())}multiply(p){if(!o.isValidNot0(p))throw new Error("invalid scalar: expected 1 <= sc < curve.n");let{p:m,f:w}=y.cached(this,p,U=>oe(d,U));return oe(d,[m,w])[0]}multiplyUnsafe(p,m=d.ZERO){if(!o.isValid(p))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return p===Tt?d.ZERO:this.is0()||p===z?this:y.unsafe(this,p,w=>oe(d,w),m)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return y.unsafe(this,s.n).is0()}toAffine(p){return a(this,p)}clearCofactor(){return i===z?this:this.multiplyUnsafe(i)}toBytes(){let{x:p,y:m}=this.toAffine(),w=r.toBytes(m);return w[w.length-1]|=p&z?128:0,w}toHex(){return Ot(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(p){return oe(d,p)}static msm(p,m){return Le(d,o,p,m)}_setWindowSize(p){this.precompute(p)}toRawBytes(){return this.toBytes()}}d.BASE=new d(s.Gx,s.Gy,z,f(s.Gx*s.Gy)),d.ZERO=new d(Tt,z,z,Tt),d.Fp=r,d.Fn=o;let y=new Ue(d,o.BITS);return d.BASE.precompute(8),d}var _e=class{constructor(t){this.ep=t}static fromBytes(t){vn()}static fromHex(t){vn()}get x(){return this.toAffine().x}get y(){return this.toAffine().y}clearCofactor(){return this}assertValidity(){this.ep.assertValidity()}toAffine(t){return this.ep.toAffine(t)}toHex(){return Ot(this.toBytes())}toString(){return this.toHex()}isTorsionFree(){return!0}isSmallOrder(){return!1}add(t){return this.assertSame(t),this.init(this.ep.add(t.ep))}subtract(t){return this.assertSame(t),this.init(this.ep.subtract(t.ep))}multiply(t){return this.init(this.ep.multiply(t))}multiplyUnsafe(t){return this.init(this.ep.multiplyUnsafe(t))}double(){return this.init(this.ep.double())}negate(){return this.init(this.ep.negate())}precompute(t,n){return this.init(this.ep.precompute(t,n))}toRawBytes(){return this.toBytes()}};function Ks(e,t,n={}){if(typeof t!="function")throw new Error('"hash" function param is required');Kt(n,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:r}=n,{BASE:o,Fp:s,Fn:i}=e,c=n.randomBytes||X,f=n.adjustScalarBytes||(b=>b),u=n.domain||((b,E,v)=>{if(Ae(v,"phflag"),E.length||v)throw new Error("Contexts/pre-hash are not supported");return b});function h(b){return i.create(ot(b))}function l(b){let E=w.secretKey;b=Y("private key",b,E);let v=Y("hashed private key",t(b),2*E),L=f(v.slice(0,E)),B=v.slice(E,2*E),S=h(L);return{head:L,prefix:B,scalar:S}}function a(b){let{head:E,prefix:v,scalar:L}=l(b),B=o.multiply(L),S=B.toBytes();return{head:E,prefix:v,scalar:L,point:B,pointBytes:S}}function x(b){return a(b).pointBytes}function d(b=Uint8Array.of(),...E){let v=Vt(...E);return h(t(u(v,Y("context",b),!!r)))}function y(b,E,v={}){b=Y("message",b),r&&(b=r(b));let{prefix:L,scalar:B,pointBytes:S}=a(E),_=d(v.context,L,b),H=o.multiply(_).toBytes(),O=d(v.context,H,S,b),R=i.create(_+O*B);if(!i.isValid(R))throw new Error("sign failed: invalid s");let A=Vt(H,i.toBytes(R));return ne(A,w.signature,"result")}let g={zip215:!0};function p(b,E,v,L=g){let{context:B,zip215:S}=L,_=w.signature;b=Y("signature",b,_),E=Y("message",E),v=Y("publicKey",v,w.publicKey),S!==void 0&&Ae(S,"zip215"),r&&(E=r(E));let H=_/2,O=b.subarray(0,H),R=ot(b.subarray(H,_)),A,M,K;try{A=e.fromBytes(v,S),M=e.fromBytes(O,S),K=o.multiplyUnsafe(R)}catch{return!1}if(!S&&A.isSmallOrder())return!1;let D=d(B,M.toBytes(),A.toBytes(),E);return M.add(A.multiplyUnsafe(D)).subtract(K).clearCofactor().is0()}let m=s.BYTES,w={secretKey:m,publicKey:m,signature:2*m,seed:m};function U(b=c(w.seed)){return ne(b,w.seed,"seed")}function k(b){let E=T.randomSecretKey(b);return{secretKey:E,publicKey:x(E)}}function C(b){return Ht(b)&&b.length===i.BYTES}function N(b,E){try{return!!e.fromBytes(b,E)}catch{return!1}}let T={getExtendedPublicKey:a,randomSecretKey:U,isValidSecretKey:C,isValidPublicKey:N,toMontgomery(b){let{y:E}=e.fromBytes(b),v=w.publicKey,L=v===32;if(!L&&v!==57)throw new Error("only defined for 25519 and 448");let B=L?s.div(z+E,z-E):s.div(E-z,E+z);return s.toBytes(B)},toMontgomerySecret(b){let E=w.secretKey;ne(b,E);let v=t(b.subarray(0,E));return f(v).subarray(0,E)},randomPrivateKey:U,precompute(b=8,E=e.BASE){return E.precompute(b,!1)}};return Object.freeze({keygen:k,getPublicKey:x,sign:y,verify:p,utils:T,Point:e,lengths:w})}function qs(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},n=e.Fp,r=mt(t.n,e.nBitLength,!0),o={Fp:n,Fn:r,uvRatio:e.uvRatio},s={randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:o,hash:e.hash,eddsaOpts:s}}function Ds(e,t){let n=t.Point;return Object.assign({},t,{ExtendedPoint:n,CURVE:e,nBitLength:n.Fn.BITS,nByteLength:n.Fn.BYTES})}function so(e){let{CURVE:t,curveOpts:n,hash:r,eddsaOpts:o}=qs(e),s=Ms(t,n),i=Ks(s,r,o);return Ds(e,i)}var se=BigInt(0),Xt=BigInt(1),Te=BigInt(2);function Fs(e){return Kt(e,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...e})}function io(e){let t=Fs(e),{P:n,type:r,adjustScalarBytes:o,powPminus2:s,randomBytes:i}=t,c=r==="x25519";if(!c&&r!=="x448")throw new Error("invalid type");let f=i||X,u=c?255:448,h=c?32:56,l=BigInt(c?9:5),a=BigInt(c?121665:39081),x=c?Te**BigInt(254):Te**BigInt(447),d=c?BigInt(8)*Te**BigInt(251)-Xt:BigInt(4)*Te**BigInt(445)-Xt,y=x+d+Xt,g=B=>F(B,n),p=m(l);function m(B){return Se(g(B),h)}function w(B){let S=Y("u coordinate",B,h);return c&&(S[31]&=127),g(ot(S))}function U(B){return ot(o(Y("scalar",B,h)))}function k(B,S){let _=T(w(S),U(B));if(_===se)throw new Error("invalid private or public key received");return m(_)}function C(B){return k(B,p)}function N(B,S,_){let H=g(B*(S-_));return S=g(S-H),_=g(_+H),{x_2:S,x_3:_}}function T(B,S){Pt("u",B,se,n),Pt("scalar",S,x,y);let _=S,H=B,O=Xt,R=se,A=B,M=Xt,K=se;for(let P=BigInt(u-1);P>=se;P--){let st=_>>P&Xt;K^=st,{x_2:O,x_3:A}=N(K,O,A),{x_2:R,x_3:M}=N(K,R,M),K=st;let it=O+R,ct=g(it*it),ft=O-R,ht=g(ft*ft),dt=ct-ht,Oo=A+M,Ro=A-M,Yn=g(Ro*it),Wn=g(Oo*ft),Qn=Yn+Wn,Jn=Yn-Wn;A=g(Qn*Qn),M=g(H*g(Jn*Jn)),O=g(ct*ht),R=g(dt*(ct+g(a*dt)))}({x_2:O,x_3:A}=N(K,O,A)),{x_2:R,x_3:M}=N(K,R,M);let D=s(R);return g(O*D)}let b={secretKey:h,publicKey:h,seed:h},E=(B=f(h))=>(Z(B,b.seed),B);function v(B){let S=E(B);return{secretKey:S,publicKey:C(S)}}return{keygen:v,getSharedSecret:(B,S)=>k(B,S),getPublicKey:B=>C(B),scalarMult:k,scalarMultBase:C,utils:{randomSecretKey:E,randomPrivateKey:E},GuBytes:p.slice(),lengths:b}}var js=BigInt(0),Bt=BigInt(1),co=BigInt(2),zs=BigInt(3),Zs=BigInt(5),Gs=BigInt(8),$t=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),ie={p:$t,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:Gs,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function uo(e){let t=BigInt(10),n=BigInt(20),r=BigInt(40),o=BigInt(80),s=$t,c=e*e%s*e%s,f=nt(c,co,s)*c%s,u=nt(f,Bt,s)*e%s,h=nt(u,Zs,s)*u%s,l=nt(h,t,s)*h%s,a=nt(l,n,s)*l%s,x=nt(a,r,s)*a%s,d=nt(x,o,s)*x%s,y=nt(d,o,s)*x%s,g=nt(y,t,s)*h%s;return{pow_p_5_8:nt(g,co,s)*e%s,b2:c}}function lo(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Nn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function kn(e,t){let n=$t,r=F(t*t*t,n),o=F(r*r*t,n),s=uo(e*o).pow_p_5_8,i=F(e*r*s,n),c=F(t*i*i,n),f=i,u=F(i*Nn,n),h=c===e,l=c===F(-e,n),a=c===F(-e*Nn,n);return h&&(i=f),(l||a)&&(i=u),bt(i,n)&&(i=F(-i,n)),{isValid:h||l,value:i}}var Et=mt(ie.p,{isLE:!0}),Vs=mt(ie.n,{isLE:!0}),Ps={...ie,Fp:Et,hash:xr,adjustScalarBytes:lo,uvRatio:kn},Dt=so(Ps);var Ce=(()=>{let e=Et.ORDER;return io({P:e,type:"x25519",powPminus2:t=>{let{pow_p_5_8:n,b2:r}=uo(t);return F(nt(n,zs,e)*r,e)},adjustScalarBytes:lo})})();var On=Nn,Xs=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),$s=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Ys=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Ws=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),fo=e=>kn(Bt,e),Qs=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Rn=e=>Dt.Point.Fp.create(ot(e)&Qs);function ao(e){let{d:t}=ie,n=$t,r=p=>Et.create(p),o=r(On*e*e),s=r((o+Bt)*Ys),i=BigInt(-1),c=r((i-t*o)*r(o+t)),{isValid:f,value:u}=kn(s,c),h=r(u*e);bt(h,n)||(h=r(-h)),f||(u=h),f||(i=o);let l=r(i*(o-Bt)*Ws-c),a=u*u,x=r((u+u)*c),d=r(l*Xs),y=r(Bt-a),g=r(Bt+a);return new Dt.Point(r(x*g),r(y*d),r(d*g),r(x*y))}function Js(e){Z(e,64);let t=Rn(e.subarray(0,32)),n=ao(t),r=Rn(e.subarray(32,64)),o=ao(r);return new At(n.add(o))}var At=class e extends _e{constructor(t){super(t)}static fromAffine(t){return new e(Dt.Point.fromAffine(t))}assertSame(t){if(!(t instanceof e))throw new Error("RistrettoPoint expected")}init(t){return new e(t)}static hashToCurve(t){return Js(Y("ristrettoHash",t,64))}static fromBytes(t){Z(t,32);let{a:n,d:r}=ie,o=$t,s=U=>Et.create(U),i=Rn(t);if(!qr(Et.toBytes(i),t)||bt(i,o))throw new Error("invalid ristretto255 encoding 1");let c=s(i*i),f=s(Bt+n*c),u=s(Bt-n*c),h=s(f*f),l=s(u*u),a=s(n*r*h-l),{isValid:x,value:d}=fo(s(a*l)),y=s(d*u),g=s(d*y*a),p=s((i+i)*y);bt(p,o)&&(p=s(-p));let m=s(f*g),w=s(p*m);if(!x||bt(w,o)||m===js)throw new Error("invalid ristretto255 encoding 2");return new e(new Dt.Point(p,m,Bt,w))}static fromHex(t){return e.fromBytes(Y("ristrettoHex",t,32))}static msm(t,n){return Le(e,Dt.Point.Fn,t,n)}toBytes(){let{X:t,Y:n,Z:r,T:o}=this.ep,s=$t,i=g=>Et.create(g),c=i(i(r+n)*i(r-n)),f=i(t*n),u=i(f*f),{value:h}=fo(i(c*u)),l=i(h*c),a=i(h*f),x=i(l*a*o),d;if(bt(o*x,s)){let g=i(n*On),p=i(t*On);t=g,n=p,d=i(l*$s)}else d=a;bt(t*x,s)&&(n=i(-n));let y=i((r-n)*d);return bt(y,s)&&(y=i(-y)),Et.toBytes(y)}equals(t){this.assertSame(t);let{X:n,Y:r}=this.ep,{X:o,Y:s}=t.ep,i=u=>Et.create(u),c=i(n*s)===i(r*o),f=i(r*s)===i(n*o);return c||f}is0(){return this.equals(e.ZERO)}};At.BASE=new At(Dt.Point.BASE);At.ZERO=new At(Dt.Point.ZERO);At.Fp=Et;At.Fn=Vs;var ho=!1,ti=!1;async function po(e,t){if(ti)return await t();try{return await e()}catch(n){if(n instanceof ReferenceError||n instanceof DOMException&&n.name==="NotSupportedError")return await t();throw n}}async function He(e,t){return await po(async()=>{let n=Mn(e)?e:await ni(e),r=await crypto.subtle.importKey("raw",t,{name:"X25519"},ho,[]);return new Uint8Array(await crypto.subtle.deriveBits({name:"X25519",public:r},n,256))},()=>{if(Mn(e))throw new Error("CryptoKey provided but X25519 WebCrypto is not supported");return Ce.scalarMult(e,t)})}async function ce(e){return await po(async()=>He(e,Ce.GuBytes),()=>{if(Mn(e))throw new Error("CryptoKey provided but X25519 WebCrypto is not supported");return Ce.scalarMultBase(e)})}var ei=new Uint8Array([48,46,2,1,0,48,5,6,3,43,101,110,4,34,4,32]);async function ni(e){if(e.length!==32)throw new Error("X25519 private key must be 32 bytes");let t=new Uint8Array([...ei,...e]);return crypto.subtle.importKey("pkcs8",t,{name:"X25519"},ho,["deriveBits"])}function Mn(e){return typeof CryptoKey<"u"&&e instanceof CryptoKey}var Ne=class{s;transcript=[];buf=new Uint8Array(0);constructor(t){this.s=t.getReader()}async readLine(){let t=[];for(;;){let n=this.buf.indexOf(10);if(n>=0)return t.push(this.buf.subarray(0,n)),this.transcript.push(this.buf.subarray(0,n+1)),this.buf=this.buf.subarray(n+1),oi(Ft(t));this.buf.length>0&&(t.push(this.buf),this.transcript.push(this.buf));let r=await this.s.read();if(r.done)return this.buf=Ft(t),null;this.buf=r.value}}close(){return this.s.releaseLock(),{rest:this.buf,transcript:Ft(this.transcript)}}};function oi(e){return e.forEach(t=>{if(t<32||t>126)throw Error("invalid non-ASCII byte in header")}),new TextDecoder().decode(e)}function Ft(e){let t=e.reduce(((o,s)=>o+s.length),0),n=new Uint8Array(t),r=0;for(let o of e)n.set(o,r),r+=o.length;return n}function Yt(e,...t){return e.pipeThrough(new TransformStream({start(n){for(let r of t)n.enqueue(r)}}))}function Oe(e){return new ReadableStream({start(t){t.enqueue(e),t.close()}})}async function Kn(e){if(!(e instanceof ReadableStream))throw new Error("readAll expects a ReadableStream<Uint8Array>");return new Uint8Array(await new Response(e).arrayBuffer())}async function xo(e){if(!(e instanceof ReadableStream))throw new Error("readAllString expects a ReadableStream<Uint8Array>");return await new Response(e).text()}async function yo(e,t){let n=e.getReader(),r=[],o=0;for(;o<t;){let{done:f,value:u}=await n.read();if(f)throw Error("stream ended before reading "+t+" bytes");r.push(u),o+=u.length}n.releaseLock();let s=Ft(r),i=s.subarray(0,t),c=Yt(e,s.subarray(t));return{data:i,rest:c}}var lt=class{args;body;constructor(t,n){this.args=t,this.body=n}};async function si(e){let t=await e.readLine();if(t===null)throw Error("invalid stanza");let n=t.split(" ");if(n.length<2||n.shift()!=="->")return{next:t};for(let s of n)if(s.length===0)throw Error("invalid stanza");let r=[];for(;;){let s=await e.readLine();if(s===null)throw Error("invalid stanza");let i=tt.decode(s);if(i.length>48)throw Error("invalid stanza");if(r.push(i),i.length<48)break}let o=Ft(r);return{s:new lt(n,o)}}async function go(e){let t=new Ne(e),n=await t.readLine();if(n!=="age-encryption.org/v1")throw Error("invalid version "+(n??"line"));let r=[];for(;;){let{s:o,next:s}=await si(t);if(o!==void 0){r.push(o);continue}if(!s.startsWith("--- "))throw Error("invalid header");let i=tt.decode(s.slice(4)),{rest:c,transcript:f}=t.close(),u=f.slice(0,f.length-1-s.length+3);return{stanzas:r,headerNoMAC:u,MAC:i,headerSize:f.length,rest:Yt(e,c)}}}function qn(e){let t=[];t.push(`age-encryption.org/v1
`);for(let n of e){t.push("-> "+n.args.join(" ")+`
`);for(let r=0;r<n.body.length;r+=48){let o=r+48;o>n.body.length&&(o=n.body.length),t.push(tt.encode(n.body.subarray(r,o))+`
`)}n.body.length%48===0&&t.push(`
`)}return t.push("---"),new TextEncoder().encode(t.join(""))}function wo(e,t){return Ft([qn(e),new TextEncoder().encode(" "+tt.encode(t)+`
`)])}function bo(){let e=X(32),t=ut.encodeFromBytes("AGE-SECRET-KEY-",e).toUpperCase();return Promise.resolve(t)}async function mo(e){let t;if(Eo(e))t=e;else{let r=ut.decodeToBytes(e);if(!e.startsWith("AGE-SECRET-KEY-1")||r.prefix.toUpperCase()!=="AGE-SECRET-KEY-"||r.bytes.length!==32)throw Error("invalid identity");t=r.bytes}let n=await ce(t);return ut.encodeFromBytes("age",n)}var Re=class{recipient;constructor(t){let n=ut.decodeToBytes(t);if(!t.startsWith("age1")||n.prefix.toLowerCase()!=="age"||n.bytes.length!==32)throw Error("invalid recipient");this.recipient=n.bytes}async wrapFileKey(t){let n=X(32),r=await ce(n),o=await He(n,this.recipient),s=new Uint8Array(r.length+this.recipient.length);s.set(r),s.set(this.recipient,r.length);let i=vt(et,o,s,"age-encryption.org/v1/X25519",32);return[new lt(["X25519",tt.encode(r)],qe(t,i))]}},ke=class{identity;recipient;constructor(t){if(Eo(t)){this.identity=t,this.recipient=ce(t);return}let n=ut.decodeToBytes(t);if(!t.startsWith("AGE-SECRET-KEY-1")||n.prefix.toUpperCase()!=="AGE-SECRET-KEY-"||n.bytes.length!==32)throw Error("invalid identity");this.identity=n.bytes,this.recipient=ce(n.bytes)}async unwrapFileKey(t){for(let n of t){if(n.args.length<1||n.args[0]!=="X25519")continue;if(n.args.length!==2)throw Error("invalid X25519 stanza");let r=tt.decode(n.args[1]);if(r.length!==32)throw Error("invalid X25519 stanza");let o=await He(this.identity,r),s=await this.recipient,i=new Uint8Array(r.length+s.length);i.set(r),i.set(s,r.length);let c=vt(et,o,i,"age-encryption.org/v1/X25519",32),f=De(n.body,c);if(f!==null)return f}return null}},Me=class{passphrase;logN;constructor(t,n){this.passphrase=t,this.logN=n}wrapFileKey(t){let n=X(16),r="age-encryption.org/v1/scrypt",o=new Uint8Array(r.length+16);o.set(new TextEncoder().encode(r)),o.set(n,r.length);let s=dn(this.passphrase,o,{N:2**this.logN,r:8,p:1,dkLen:32});return[new lt(["scrypt",tt.encode(n),this.logN.toString()],qe(t,s))]}},Ke=class{passphrase;constructor(t){this.passphrase=t}unwrapFileKey(t){for(let n of t){if(n.args.length<1||n.args[0]!=="scrypt")continue;if(t.length!==1)throw Error("scrypt recipient is not the only one in the header");if(n.args.length!==3||!/^[1-9][0-9]*$/.test(n.args[2]))throw Error("invalid scrypt stanza");let r=tt.decode(n.args[1]);if(r.length!==16)throw Error("invalid scrypt stanza");let o=Number(n.args[2]);if(o>20)throw Error("scrypt work factor is too high");let s="age-encryption.org/v1/scrypt",i=new Uint8Array(s.length+16);i.set(new TextEncoder().encode(s)),i.set(r,s.length);let c=dn(this.passphrase,i,{N:2**o,r:8,p:1,dkLen:32}),f=De(n.body,c);if(f!==null)return f}return null}};function qe(e,t){let n=new Uint8Array(12);return _t(t,n).encrypt(e)}function De(e,t){if(e.length!==32)throw Error("invalid stanza");let n=new Uint8Array(12);try{return _t(t,n).decrypt(e)}catch{return null}}function Eo(e){return typeof CryptoKey<"u"&&e instanceof CryptoKey}var jt=16,Fn=64*1024,Dn=Fn+jt;function Bo(e){let t=new Uint8Array(12),n=()=>{for(let i=t.length-2;i>=0&&(t[i]++,t[i]===0);i--);},r=!0,o=new Uint8Array(Dn),s=0;return new TransformStream({transform(i,c){for(;i.length>0;){if(s===o.length){let u=_t(e,t).decrypt(o);c.enqueue(u),n(),s=0,r=!1}let f=Math.min(o.length-s,i.length);o.set(i.subarray(0,f),s),s+=f,i=i.subarray(f)}},flush(i){t[11]=1;let c=_t(e,t).decrypt(o.subarray(0,s));if(!r&&c.length===0)throw new Error("final chunk is empty");i.enqueue(c)}})}function Ao(e){if(e<jt)throw Error("ciphertext is too small");if(e===jt)return 0;let t=Math.floor(e/Dn),n=e%Dn;if(0<n&&n<=jt)throw Error("ciphertext size is invalid");let r=e;return r-=t*jt,r-=n>0?jt:0,r}function So(e){let t=new Uint8Array(12),n=()=>{for(let s=t.length-2;s>=0&&(t[s]++,t[s]===0);s--);},r=new Uint8Array(Fn),o=0;return new TransformStream({transform(s,i){for(;s.length>0;){if(o===r.length){let f=_t(e,t).encrypt(r);i.enqueue(f),n(),o=0}let c=Math.min(r.length-o,s.length);r.set(s.subarray(0,c),o),o+=c,s=s.subarray(c)}},flush(s){t[11]=1;let i=_t(e,t).encrypt(r.subarray(0,o));s.enqueue(i)}})}function vo(e){let t=Math.max(1,Math.ceil(e/Fn));return e+jt*t}var jn={};Ge(jn,{decode:()=>ci,encode:()=>ii});function ii(e){let t=[];t.push(`-----BEGIN AGE ENCRYPTED FILE-----
`);for(let n=0;n<e.length;n+=48){let r=n+48;r>e.length&&(r=e.length),t.push(un.encode(e.subarray(n,r))+`
`)}return t.push(`-----END AGE ENCRYPTED FILE-----
`),t.join("")}function ci(e){let t=e.trim().replaceAll(`\r
`,`
`).split(`
`);if(t.shift()!=="-----BEGIN AGE ENCRYPTED FILE-----")throw Error("invalid header");if(t.pop()!=="-----END AGE ENCRYPTED FILE-----")throw Error("invalid footer");function n(r,o){return r===t.length-1?o.length>0&&o.length<=64&&o.length%4===0:o.length===64}if(!t.every((r,o)=>n(o,r)))throw Error("invalid line length");if(!t.every(r=>/^[A-Za-z0-9+/=]+$/.test(r)))throw Error("invalid base64");return un.decode(t.join(""))}var Pn={};Ge(Pn,{WebAuthnIdentity:()=>Vn,WebAuthnRecipient:()=>Gn,createCredential:()=>ui});function Fe(e){if(e.length===0)throw Error("cbor: unexpected EOF");let t=e[0]>>5,n=e[0]&31;if(n<=23)return[t,n,e.subarray(1)];if(n===24){if(e.length<2)throw Error("cbor: unexpected EOF");return[t,e[1],e.subarray(2)]}if(n===25){if(e.length<3)throw Error("cbor: unexpected EOF");return[t,e[1]<<8|e[2],e.subarray(3)]}throw Error("cbor: unsupported argument encoding")}function Io(e){let[t,n,r]=Fe(e);if(t!==0)throw Error("cbor: expected unsigned integer");return[n,r]}function Uo(e){let[t,n,r]=Fe(e);if(t!==2)throw Error("cbor: expected byte string");if(n>r.length)throw Error("cbor: unexpected EOF");return[r.subarray(0,n),r.subarray(n)]}function zn(e){let[t,n,r]=Fe(e);if(t!==3)throw Error("cbor: expected text string");if(n>r.length)throw Error("cbor: unexpected EOF");return[new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0}).decode(r.subarray(0,n)),r.subarray(n)]}function Lo(e){let[t,n,r]=Fe(e);if(t!==4)throw Error("cbor: expected array");let o=r,s=[];for(let i=0;i<n;i++){let c;[c,o]=zn(o),s.push(c)}return[s,o]}function _o(e){if(e<=23)return new Uint8Array([e]);if(e<=255)return new Uint8Array([24,e]);if(e<=65535)return new Uint8Array([25,e>>8,e&255]);throw Error("cbor: unsigned integer too large")}function To(e){if(e.length<=23)return new Uint8Array([64|e.length,...e]);if(e.length<=255)return new Uint8Array([88,e.length,...e]);if(e.length<=65535)return new Uint8Array([89,e.length>>8,e.length&255,...e]);throw Error("cbor: byte string too long")}function Zn(e){let t=new TextEncoder().encode(e);if(t.length<=23)return new Uint8Array([96|t.length,...t]);if(t.length<=255)return new Uint8Array([120,t.length,...t]);if(t.length<=65535)return new Uint8Array([121,t.length>>8,t.length&255,...t]);throw Error("cbor: text string too long")}function Co(e){let t=e.flatMap(n=>[...Zn(n)]);if(e.length<=23)return new Uint8Array([128|e.length,...t]);if(e.length<=255)return new Uint8Array([152,e.length,...t]);if(e.length<=65535)return new Uint8Array([153,e.length>>8,e.length&255,...t]);throw Error("cbor: array too long")}var ai=[{type:"public-key",alg:-8},{type:"public-key",alg:-7},{type:"public-key",alg:-257}];async function ui(e){let t=await navigator.credentials.create({publicKey:{rp:{name:"",id:e.rpId},user:{name:e.keyName,id:X(8),displayName:""},pubKeyCredParams:ai,authenticatorSelection:{requireResidentKey:e.type!=="security-key",residentKey:e.type!=="security-key"?"required":"discouraged",userVerification:"required"},hints:e.type==="security-key"?["security-key"]:[],extensions:{prf:{}},challenge:new Uint8Array([0]).buffer}});if(!t.getClientExtensionResults().prf?.enabled)throw Error("PRF extension not available (need macOS 15+, Chrome 132+)");let n=e.rpId??new URL(window.origin).hostname;return li(t,n)}var Ho="AGE-PLUGIN-FIDO2PRF-";function li(e,t){let n=e.response,r=_o(1),o=To(new Uint8Array(e.rawId)),s=Zn(t),i=Co(n.getTransports()),c=new Uint8Array([...r,...o,...s,...i]);return ut.encode(Ho,ut.toWords(c),!1).toUpperCase()}function hi(e){let t=ut.decodeToBytes(e);if(!e.startsWith(Ho+"1"))throw Error("invalid identity");let[n,r]=Io(t.bytes);if(n!==1)throw Error("unsupported identity version");let[o,s]=Uo(r),[i,c]=zn(s),[f]=Lo(c);return[o,i,f]}var ze="age-encryption.org/fido2prf",je=class{credId;transports;rpId;constructor(t){if(t?.identity){let[n,r,o]=hi(t.identity);this.credId=n,this.transports=o,this.rpId=r}else this.rpId=t?.rpId}async getCredential(t){let r=(await navigator.credentials.get({publicKey:{allowCredentials:this.credId?[{id:this.credId,transports:this.transports,type:"public-key"}]:[],challenge:X(16),extensions:{prf:{eval:di(t)}},userVerification:"required",rpId:this.rpId}})).getClientExtensionResults().prf?.results;if(r===void 0)throw Error("PRF extension not available (need macOS 15+, Chrome 132+)");return r}},Gn=class extends je{async wrapFileKey(t){let n=X(16),r=await this.getCredential(n),o=No(r);return[new lt([ze,tt.encode(n)],qe(t,o))]}},Vn=class extends je{async unwrapFileKey(t){for(let n of t){if(n.args.length<1||n.args[0]!==ze)continue;if(n.args.length!==2)throw Error("invalid prf stanza");let r=tt.decode(n.args[1]);if(r.length!==16)throw Error("invalid prf stanza");let o=await this.getCredential(r),s=No(o),i=De(n.body,s);if(i!==null)return i}return null}};function di(e){let t=new TextEncoder().encode(ze),n=new Uint8Array(t.length+e.length+1);n.set(t,0),n[t.length]=1,n.set(e,t.length+1);let r=new Uint8Array(t.length+e.length+1);return r.set(t,0),r[t.length]=2,r.set(e,t.length+1),{first:n,second:r}}function No(e){if(e.second===void 0)throw Error("Missing second PRF result");let t=new Uint8Array(e.first.byteLength+e.second.byteLength);return t.set(new Uint8Array(e.first),0),t.set(new Uint8Array(e.second),e.first.byteLength),Ye(et,t,ze)}var Xn=class{passphrase=null;scryptWorkFactor=18;recipients=[];setPassphrase(t){if(this.passphrase!==null)throw new Error("can encrypt to at most one passphrase");if(this.recipients.length!==0)throw new Error("can't encrypt to both recipients and passphrases");this.passphrase=t}setScryptWorkFactor(t){this.scryptWorkFactor=t}addRecipient(t){if(this.passphrase!==null)throw new Error("can't encrypt to both recipients and passphrases");typeof t=="string"?this.recipients.push(new Re(t)):this.recipients.push(t)}async encrypt(t){let n=X(16),r=[],o=this.recipients;this.passphrase!==null&&(o=[new Me(this.passphrase,this.scryptWorkFactor)]);for(let l of o)r.push(...await l.wrapFileKey(n));let s=vt(et,n,void 0,"header",32),i=xt(et,s,qn(r)),c=wo(r,i),f=X(16),u=vt(et,n,f,"payload",32),h=So(u);return t instanceof ReadableStream?Object.assign(Yt(t.pipeThrough(h),c,f),{size:l=>vo(l)+c.length+f.length}):(typeof t=="string"&&(t=new TextEncoder().encode(t)),await Kn(Yt(Oe(t).pipeThrough(h),c,f)))}},$n=class{identities=[];addPassphrase(t){this.identities.push(new Ke(t))}addIdentity(t){typeof t=="string"||xi(t)?this.identities.push(new ke(t)):this.identities.push(t)}async decrypt(t,n){let r=t instanceof ReadableStream?t:Oe(t),{fileKey:o,headerSize:s,rest:i}=await this.decryptHeaderInternal(r),{data:c,rest:f}=await yo(i,16),u=vt(et,o,c,"payload",32),h=Bo(u),l=f.pipeThrough(h),a=Object.assign(l,{size:x=>Ao(x-s-c.length)});return t instanceof ReadableStream?a:n==="text"?await xo(l):await Kn(l)}async decryptHeader(t){return(await this.decryptHeaderInternal(Oe(t))).fileKey}async decryptHeaderInternal(t){let n=await go(t),r=await this.unwrapFileKey(n.stanzas);if(r===null)throw Error("no identity matched any of the file's recipients");let o=vt(et,r,void 0,"header",32),s=xt(et,o,n.headerNoMAC);if(!pi(n.MAC,s))throw Error("invalid header HMAC");return{fileKey:r,headerSize:n.headerSize,rest:n.rest}}async unwrapFileKey(t){for(let n of this.identities){let r=await n.unwrapFileKey(t);if(r!==null)return r}return null}};function pi(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}function xi(e){return typeof CryptoKey<"u"&&e instanceof CryptoKey}return Do(yi);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@scure/base/lib/esm/index.js:
  (*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/ciphers/esm/utils.js:
  (*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/abstract/montgomery.js:
@noble/curves/esm/ed25519.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
